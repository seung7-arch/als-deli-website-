const isSeafoodPlatter = 
        cat.n.includes("whiting platter") || 
        cat.n.includes("tilapia platter") || 
        cat.n.includes("flounder platter") || 
        cat.n.includes("croaker platter") ||
        cat.n.includes("shrimp platter") ||
        cat.n.includes("shrimp basket") ||
        cat.n.includes("scallop platter") ||
        cat.n.includes("combo seafood platter") ||
        cat.n.includes("crab stick");

      toggleSec("sec-breakfast-toppings", cat.isBreakfastSandwich);
      toggleSec("sec-sub-toppings", (cat.isSubsAndSandwiches || isWhitingSub) && !isReuben && !isChickenTendersOrNuggets);
      toggleSec("sec-reuben-note", isReuben);
      toggleSec("sec-seafood-bread", isSeafoodPlatter);

      const showMeatChoice = cat.isAllDayBreakfast && needsPlatterMeatChoice(name);
      toggleSec("sec-meat-choice-platters", showMeatChoice);

      toggleSec("sec-bread", cat.isBreakfastSandwich && !cat.isCroissant);
      toggleSec("sec-toasted", cat.isBreakfastSandwich);
      toggleSec("sec-eggs-sandwich", cat.isBreakfastSandwich);
      toggleSec("sec-bread-upsell", cat.isAllDayBreakfast);
      toggleSec("sec-extra-meat-breakfast", cat.isBreakfastSandwich || cat.isAllDayBreakfast);
      toggleSec("sec-extra-meat-lunch", cat.isSubsAndSandwiches && !cat.noExtraMeatLunch && !isChickenTendersOrNuggets && !isWhitingSub);

      const isFrySide = cat.n.includes("french fries") || cat.n.includes("home fries");
      const showSauces =
        (cat.isSubsAndSandwiches && cat.isComboWithFries && !isChickenTendersOrNuggets) ||
        (isWhitingSub && cat.isComboWithFries) ||
        cat.isWingPlatter ||
        (cat.isWings && !cat.isSidesDrinks) ||
        (cat.isSeafoodDinner && !isChickenTendersOrNuggets) ||
        isSeafoodPlatter ||
        isFrySide ||
        cat.isAllDayBreakfast;

      toggleSec("sec-sauces", showSauces);

      document.getElementById("customizer-overlay").classList.remove("hidden");
    }

    function needsPlatterMeatChoice(nameRaw) {
      const n = (nameRaw || "").toLowerCase();
      return (
        n.includes("pancakes breakfast") ||
        n.includes("waffles breakfast") ||
        n === "french toast" ||
        n.includes("western omelette")
      );
    }

    function closeCustomizer() {
      document.getElementById("customizer-overlay").classList.add("hidden");
    }

    function toggleSec(id, show) {
      const el = document.getElementById(id);
      if (!el) return;
      el.classList.toggle("hidden", !show);
    }

    function selectStandardSub() {
      const standardToppings = ['Lettuce', 'Tomato', 'Mayonnaise', 'Mustard'];
      const toppings = document.querySelectorAll('[data-group="toppingMulti"]');
      toppings.forEach(btn => {
        const val = btn.getAttribute('data-val');
        if (standardToppings.includes(val)) {
          btn.classList.add("selected");
        }
      });
    }

    function selectStandardBreakfast() {
      const standardToppings = ['Lettuce', 'Tomato', 'Mayonnaise', 'Mustard'];
      const toppings = document.querySelectorAll('[data-group="bfToppingMulti"]');
      toppings.forEach(btn => {
        const val = btn.getAttribute('data-val');
        if (standardToppings.includes(val)) {
          btn.classList.add("selected");
        }
      });
    }

    document.addEventListener("click", (e) => {
      const btn = e.target.closest(".chip");
      if (!btn) return;

      const overlay = document.getElementById("customizer-overlay");
      if (overlay.classList.contains("hidden")) return;

      const group = btn.getAttribute("data-group");
      const isMulti = btn.getAttribute("data-multi") === "1";
      const billable = btn.getAttribute("data-billable") === "1";

      if (group === "meatChoice") {
        document.querySelectorAll(`.chip[data-group="meatChoice"]`).forEach(b => b.classList.remove("selected"));
        btn.classList.add("selected");
        return;
      }

      if (billable && !group) {
        btn.classList.toggle("selected");
        return;
      }

      if (!group) return;

      if (!isMulti) {
        document.querySelectorAll(`.chip[data-group="${group}"]`).forEach(b => b.classList.remove("selected"));
        btn.classList.add("selected");
      } else {
        btn.classList.toggle("selected");
      }
    });

    function addCustomizedItem() {
      const meatSec = document.getElementById("sec-meat-choice-platters");
      const meatRequired = meatSec && !meatSec.classList.contains("hidden");

      if (meatRequired) {
        const chosen = document.querySelector(`#customizer-overlay .chip.selected[data-group="meatChoice"]`);
        if (!chosen) {
          alert("Please choose a meat (Bacon, Sausage, or an upgrade).");
          return;
        }
      }

      const modifiers = [];

      document.querySelectorAll("#customizer-overlay .chip.selected[data-billable='1']").forEach(b => {
        const line = (b.getAttribute("data-line") || "").trim();
        const price = parseFloat(b.getAttribute("data-price") || "0");
        if (line && price > 0) addItemToReceipt(line, price, [], 1);
      });

      document.querySelectorAll("#customizer-overlay .chip.selected:not([data-billable='1'])").forEach(b => {
        const val = (b.getAttribute("data-val") || "").trim();
        if (val) modifiers.push(val);
      });

      const note = document.getElementById("cust-notes").value.trim();
      if (note) modifiers.push(`Note: ${note}`);

      addItemToReceipt(custItem.name, custItem.price, modifiers, 1);

      closeCustomizer();
      if (navigator.vibrate) navigator.vibrate(50);
    }

    openDebugBtn.addEventListener('click', () => {
      const pw = prompt("Admin Password:");
      if (pw === "1003") debugPanel.classList.remove('hidden');
    });
    debugCloseBtn.addEventListener('click', () => debugPanel.classList.add('hidden'));

    (function (d, t) {
      const g = d.createElement(t), s = d.getElementsByTagName(t)[0];
      g.src = "https://cdn.jsdelivr.net/gh/VapiAI/html-script-tag@latest/dist/assets/index.js";
      g.defer = true; g.async = true; s.parentNode.insertBefore(g, s);
      g.onload = function () {
        vapi = window.vapiSDK.run({ apiKey: VAPI_PUBLIC_KEY, assistant: VAPI_ASSISTANT_ID });
        setupVapiEvents();
      };
    })(document, "script");
  </script>
</body>
</html>
